{% load static %}
{% load bootstrap4 %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Ilustrações</title>
    <link rel="icon" type="image/x-icon" href="{% static 'planilha/images/ico.png' %}">
    {% bootstrap_css %}

    <link rel="stylesheet" href="{% static 'planilha/css/estilos.css' %}">
</head>

<body>

    {% include '_nav.html' %}


    <div class="container-fluid mt-4">

        <div class="row">
            <div class="col-lg-3 col-md-4">

            </div>
            <div class="col-lg-9 col-md-8">
                <div class="container-fluid mt-4">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message|safe }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">X</button>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
                <h1>
                    {% if ativo == True %}
                    Ilustrações
                    {% else %}
                    Ilustrações excluídas
                    {% endif %}
                </h1>

                <p>
                    <a href="{% url 'nova_ilustracao' %}" class="btn btn-outline-primary my-2 my-sm-0" role="button">
                        + ilustração
                    </a>
                    {% if ativo %}
                    <a href="{% url 'ilustras_excluidas' %}" class="btn btn-primary" role="button">
                        Ir para ilustrações excluídas
                    </a>
                    {% else %}
                    <a href="{% url 'ilustras' %}" class="btn btn-primary" role="button">
                        Voltar para ilustrações ativas
                    </a>
                    {% endif %}

                    {% if ativo %}
                    <a href="{% url 'ilustras' %}" class="btn btn-outline-secondary w-100" role="button">
                        <i class="fas fa-times"></i> Limpar filtros
                    </a>
                    {% else %}
                    <a href="{% url 'ilustras_excluidas' %}" class="btn btn-outline-secondary w-100" role="button">
                        <i class="fas fa-times"></i> Limpar filtros
                    </a>
                    {% endif %}
                </p>
            </div>
        </div>




        <div class="row">

            <!-- COLUNA DO FILTRO (3/12 em telas grandes, 4/12 em telas médias) -->
            <div class="col-lg-3 col-md-4">

                <!-- Wrapper com position: sticky para fixar na tela durante a rolagem -->
                <div class="sticky-filter-wrapper">
                    <div class="card shadow-sm p-3 mb-4 bg-white rounded-lg">





                        <h5 class="card-title text-xl font-bold mb-3">Filtrar ilustrações</h5>

                        <div>
                        Consulte <a href="{% url 'ajuda_regex' %}" target="_blank">aqui</a> um guia de como fazer buscas.
                        <p></p>
                        </div>



                        <form method="get">
                            {{ filter.form.as_p }}
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success w-100 mb-2">
                                    <i class="fas fa-filter"></i> Aplicar Filtros
                                </button>
                                {% if ativo %}
                                <a href="{% url 'ilustras' %}" class="btn btn-outline-secondary w-100" role="button">
                                    <i class="fas fa-times"></i> Limpar filtros
                                </a>
                                {% else %}
                                <a href="{% url 'ilustras_excluidas' %}" class="btn btn-outline-secondary w-100"
                                    role="button">
                                    <i class="fas fa-times"></i> Limpar filtros
                                </a>
                                {% endif %}
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-9 col-md-8">
                {% if pre_filtro_ativo %}
                <div class="alert alert-info alert-dismissible fade show" role="alert">
                    <i class="fas fa-filter me-2"></i> 
                    <strong>Pré-Filtro Ativo:</strong> Esta listagem está filtrada automaticamente pelas suas preferências de projetos/componentes/volume.
                    Você pode **modificar ou desativar** estas preferências na sua <a href="{% url 'preferencias' %}" class="alert-link">página de Preferências</a>.
                    <!-- <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> -->
                </div>
                {% endif %}
                <p>
                    <span>Exibindo: {{ num_linhas }} linha(s) de um total ativo de {{num_linhas_total}}.</span>

                    <button class="btn btn-success btn-sm"
                        onclick="exportTableToCSV('tabela_de_ilustracoes', 'ilustracoes.csv')">
                        Exportar tudo para CSV
                    </button>
                    <button class="btn btn-success btn-sm"
                        onclick="exportTable('tabela_de_ilustracoes', 'xlsx', 'ilustracoes');">
                        Exportar tudo para Excel
                    </button>

                    <a href="{% url 'exportar_creditos_csv' %}?{{ request.GET.urlencode }}" 
                        class="btn btn-primary btn-sm" 
                        role="button">
                        Exportar créditos em CSV
                        </a>

                    <a href="{% url 'upload_ilustracoes_excel' %}" class="btn btn-warning btn-sm">
                        <i class="fas fa-file-upload"></i> Importar atualizações do Excel
                    </a>
                </p>

                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle" id="tabela_de_ilustracoes">
                        <thead class="bg-light sticky-top">
                            <tr>
                                <th>Retranca</th>
                                <th hidden>pk</th>
                                
                                {% if preferencias_colunas.exibir_status %}
                                <th>Status</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_categoria %}
                                <th>Categoria</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_localizacao %}
                                <th>Localização</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_volume %}
                                <th>Volume</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_unidade %}
                                <th>Unidade</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_capitulo_secao %}
                                <th>Capítulo ou seção</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_pagina %}
                                <th>Página</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_tipo %}
                                <th>Tipo</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_descricao %}
                                <th>Descrição</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_observacao_edit_nuc %}
                                <th>Observação editorial e núcleo</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_lote %}
                                <th>Lote</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_liberacao_para_arte %}
                                <th>Data de liberação para arte</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_envio_pedido %}
                                <th>Data de envio do pedido</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_recebimento_rafe %}
                                <th>Data de recebimento do rafe</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_retorno_rafe %}
                                <th>Data de retorno do rafe</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_recebimento_finalizada %}
                                <th>Data de recebimento da finalizada</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_classificacao %}
                                <th>Classificação</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_credito %}
                                <th>Crédito</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_ilustrador_resgate %}
                                <th>Ilustrador resgate</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_ilustrador %}
                                <th>Ilustrador criação</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_ilustrador_ajuste %}
                                <th>Ilustrador ajuste</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_observacao_arte %}
                                <th>Observação da arte</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_pagamento %}
                                <th>Pagamento</th>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_modificado_em %}
                                <th>Modificada</th>
                                {% endif %}
                                
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for il in filter.qs %}
                            <tr>
                                <td>{{ il.retranca|default:"" }}</td>
                                <td hidden>{{ il.pk }}</td>
                                
                                {% if preferencias_colunas.exibir_status %}
                                <td>{{ il.get_status_display|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_categoria %}
                                <td>{{ il.get_categoria_display|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_localizacao %}
                                <td>{{ il.get_localizacao_display|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_volume %}
                                <td>{{ il.volume|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_unidade %}
                                <td>{{ il.unidade|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_capitulo_secao %}
                                <td>{{ il.capitulo_secao|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_pagina %}
                                <td>{{ il.pagina|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_tipo %}
                                <td>{{ il.get_tipo_display|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_descricao %}
                                <td>{{ il.descricao|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_observacao_edit_nuc %}
                                <td>{{ il.observacao_edit_nuc|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_lote %}
                                <td>{{ il.lote|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_liberacao_para_arte %}
                                <td>{{ il.data_liberacao_para_arte | date:"d/m/Y"|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_envio_pedido %}
                                <td>{{ il.data_envio_pedido | date:"d/m/Y"|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_recebimento_rafe %}
                                <td>{{ il.data_recebimento_rafe | date:"d/m/Y"|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_retorno_rafe %}
                                <td>{{ il.data_retorno_rafe | date:"d/m/Y"|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_data_recebimento_finalizada %}
                                <td>{{ il.data_recebimento_finalizada | date:"d/m/Y"|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_classificacao %}
                                <td>{{ il.classificacao|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_credito %}
                                <td>{{ il.credito|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_ilustrador_resgate %}
                                <td>{{ il.ilustrador_resgate|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_ilustrador %}
                                <td>{{ il.ilustrador|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_ilustrador_ajuste %}
                                <td>{{ il.ilustrador_ajuste|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_observacao_arte %}
                                <td>{{ il.observacao_arte|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_pagamento %}
                                <td>{{ il.get_pagamento_display|default:"" }}</td>
                                {% endif %}
                                
                                {% if preferencias_colunas.exibir_modificado_em %}
                                <td>{{ il.modificado_em | date:"d/m/Y"|default:"" }}</td>
                                {% endif %}
                                
                                <td class="text-nowrap">
                                    <a href="{% url 'detalhe_ilustracao' il.pk %}" class="btn btn-sm btn-info" target="_blank"
                                        title="Use Ctrl + Clique para abrir em nova janela">
                                        <i class="fas fa-edit"></i> Editar
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>



        </div>

        <div class="d-block" style="height: 300px;"></div>


        {% bootstrap_javascript jquery='full' %}

        <!-- Scripts para exportação de dados em CSV e Excel -->
        <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/tableexport@5.2.0/dist/js/tableexport.min.js"></script>
        <script src="{% static 'planilha/js/scripts.js' %}"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>